name: Build test specs
on:
  push:

jobs:
  build-suites:
    runs-on: ubuntu-latest
    outputs:
      #matrix: "['\"integration/homepage.cy.js,integration/sidebar.cy.js\"']"
      matrix: ${{ steps.group-files.outputs.groups}}
    steps:
      - uses: actions/checkout@v3
      - name: group files
        id: group-files
        run: |
          suites=()
          files=($(find ./e2e/browser -iname '*.cy.js' -or -iname '*.cy.ts'))
          index=1
          while [ $index -le ${#files[@]} ] 
          do  
            sub_group=$(echo ${files[@]:$index:3} | sed 's/ /,/g')
            echo "Current group is $sub_group"
            suites+=($sub_group)
            index=$(( $index + 1 ))
          done
          echo "groups=$(jq -c -n '$ARGS.positional' --args "${suites[@]}")" >> $GITHUB_OUTPUT
      - name: show-output
        run: The output of groups is ${{ steps.group-files.outputs.groups}}.


      #TODO: Add more steps to actually get the files correctly.

  compile-test-suites:
    needs: [build-suites]
    strategy:
      fail-fast: false
      matrix:
        test-spec: ${{ fromJson(needs.build-suites.outputs.matrix) }}   
    runs-on: ubuntu-latest
    steps:
      - run: echo "Here is the matrix ${{ matrix.test-spec }}"
